<?php
/**
 * @file
 * Code for the VIU Simple FAQ feature.
 */

include_once 'viu_simple_faq.features.inc';

/**
 * Implements hook_views_api_alter()
 *
 * Views api is specified by features but we want to add the template directory.
 */
function viu_simple_faq_views_api_alter(&$apis) {
  if (!empty($apis['viu_simple_faq']) && $apis['viu_simple_faq']['api'] == '3.0') {
    $apis['viu_simple_faq']['template path'] = drupal_get_path('module', 'viu_simple_faq') . '/templates';
  }
}

/**
 * Implements hook_preprocess_HOOK
 *
 * We want to override the panels_bootstrap_pane hook and inject some HTML (for the fa-icon)
 */
function viu_simple_faq_preprocess_panels_bootstrap_pane(&$vars) {
  if ($vars['title'] == "FAQ Categories") {
    $vars['title'] = '<span aria-hidden="true" class="icon-question"></span>&nbsp;' . $vars['title'];
  }
}

/**
 * Implements hook_ctools_plugin_directory().
 *
 * Tells ctools that we have content_types included in this module and where they live
 */
function viu_simple_faq_ctools_plugin_directory($owner, $plugin_type) {
  if ($owner == 'ctools' && $plugin_type == 'content_types') {
    return 'plugins/content_types';
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function viu_simple_faq_form_oa_section_node_form_alter(&$form, &$form_state, $form_id) {
  // TODO add conditional to check whether we are looking at a section page form (check taxonomy id)
  //sdpm($form_state['node']);
  //$section_term_id = $form_state['node']->field_oa_section[LANGUAGE_NONE]['0']['tid'];
  //$taxonomy = taxonomy_term_load($section_term_id);
  //dpm($taxonomy);
  //WORKING HERE
  if ($form['#node_edit_form']) {
    if (NULL == $form['body'][LANGUAGE_NONE][0]['#default_value']) {
      $form['body'][LANGUAGE_NONE][0]['#default_value'] = t('Please feel free to contact us about other specific questions that you might have.');
    }
    if (NULL == $form['body'][LANGUAGE_NONE][0]['#description']) {
      $form['body'][LANGUAGE_NONE][0]['#description'] = t('You should update the section below with a link to your staff directory, contact page or contact form.');
    }
    sdpm($form);
    sdpm($form_state);
    sdpm($form_id);
  }
}

/**
 * Implements hook_permission().
 */
function viu_simple_faq_permission() {
  return array(
    'access viu_simple_faq administration' => array(
      'title' => t('Access VIU Simple FAQ Section Administration Menu'),
    ),
  );
}
